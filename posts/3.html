<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>[eggjs]å¼‚å¸¸æ•è·ä¸­é—´ä»¶ï¼Œä¸€ä¸‹å­ç†è§£koaæ´‹è‘±åœˆæ¨¡å‹</title><link rel="stylesheet" href="/boboan.github.io/prism/prism.css"/><meta name="keywords" content="eggjs"/><meta name="description" content="eggjs"/><meta name="next-head-count" content="6"/><meta name="viewport" content="initial-scale=1, width=device-width"/><meta name="author" content="Boboan"/><link rel="shortcut icon" href="/boboan.github.io/favicon.ico" type="image/x-icon"/><link rel="manifest" href="/boboan.github.io/manifest.json"/><script>
              "serviceWorker" in navigator && window.addEventListener("load",function(){
                navigator.serviceWorker.register('/boboan.github.io/sw.js?x=0.0.3')
              })
              </script><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/boboan.github.io/_next/static/css/49c704d070ca619f.css" as="style"/><link rel="stylesheet" href="/boboan.github.io/_next/static/css/49c704d070ca619f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/boboan.github.io/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/boboan.github.io/_next/static/chunks/webpack-18f38da44cec651c.js" defer=""></script><script src="/boboan.github.io/_next/static/chunks/framework-3b5a00d5d7e8d93b.js" defer=""></script><script src="/boboan.github.io/_next/static/chunks/main-5ccbab268e1e1d15.js" defer=""></script><script src="/boboan.github.io/_next/static/chunks/pages/_app-214ffe9c92a0c833.js" defer=""></script><script src="/boboan.github.io/_next/static/chunks/901-de5250d0de6cca92.js" defer=""></script><script src="/boboan.github.io/_next/static/chunks/0-fd28c5d8a669cfc1.js" defer=""></script><script src="/boboan.github.io/_next/static/chunks/pages/posts/%5Bid%5D-099fe1992ed3694f.js" defer=""></script><script src="/boboan.github.io/_next/static/sFUQrHDn7cL7a1jlmj8Ox/_buildManifest.js" defer=""></script><script src="/boboan.github.io/_next/static/sFUQrHDn7cL7a1jlmj8Ox/_ssgManifest.js" defer=""></script><style data-href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxM.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBBc-.woff) format('woff')}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:300;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmSU5fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu72xKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu5mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7mxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7WxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu7GxKKTU1Kvnz.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCRc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfABc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCBc4AMP6lbBP.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfCxc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfChc4AMP6lbBP.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto';font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/roboto/v30/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body class="custom_class"><div id="__next"><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 14kxyr">.css-14kxyr{padding-top:48px;}</style><style data-emotion="css 1oxgxmo">.css-1oxgxmo{padding-top:48px;}</style><div class="MuiBox-root css-1oxgxmo"><header><style data-emotion="css 1unf03s">.css-1unf03s .MuiToolbar-root{padding:0;}</style><nav class="css-1unf03s"><style data-emotion="css 88oi7d">.css-88oi7d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#f5f5f5;color:rgba(0, 0, 0, 0.87);}@media print{.css-88oi7d{position:absolute;}}</style><style data-emotion="css 1xcbb95">.css-1xcbb95{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#f5f5f5;color:rgba(0, 0, 0, 0.87);}@media print{.css-1xcbb95{position:absolute;}}</style><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorDefault MuiAppBar-positionFixed mui-fixed css-1xcbb95"><style data-emotion="css 1ekb41w">.css-1ekb41w{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1ekb41w{padding-left:24px;padding-right:24px;}}@media (min-width:1536px){.css-1ekb41w{max-width:1536px;}}</style><div class="MuiContainer-root MuiContainer-maxWidthXl css-1ekb41w"><style data-emotion="css a15jfk">.css-a15jfk{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;width:100%;min-height:48px!important;}@media (min-width:600px){.css-a15jfk{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-a15jfk{min-height:48px;}}}@media (min-width:600px){.css-a15jfk{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-a15jfk"><style data-emotion="css 1o0y1dn">.css-1o0y1dn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;}</style><div class="css-1o0y1dn"><style data-emotion="css u4p24i">.css-u4p24i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-u4p24i"><style data-emotion="css 1hskriy">.css-1hskriy{width:250px;}</style><div class="MuiBox-root css-1hskriy"><style data-emotion="css ifwihp animation-1jtiq51 animation-jgfc7h animation-1s0cgyd">.css-ifwihp{position:relative;display:inline-block;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding-right:16px;padding-left:8px;color:rgba(0, 0, 0, 0.87);font-size:24px;font-weight:500;cursor:pointer;}.css-ifwihp::after{position:absolute;content:'_';color:#5973ff;right:0;top:0;font-weight:700;-webkit-animation:animation-1s0cgyd 3s ease-in-out infinite;animation:animation-1s0cgyd 3s ease-in-out infinite;}.css-ifwihp .blue{font-weight:700;color:#5973ff;}.css-ifwihp .left{display:inline-block;-webkit-transition:0.2s;transition:0.2s;}.css-ifwihp .right{display:inline-block;-webkit-transition:0.2s;transition:0.2s;}.css-ifwihp:hover .left{-webkit-animation:animation-jgfc7h 0.5s ease-in-out;animation:animation-jgfc7h 0.5s ease-in-out;}.css-ifwihp:hover .right{-webkit-animation:animation-1jtiq51 0.5s ease-in-out;animation:animation-1jtiq51 0.5s ease-in-out;}@-webkit-keyframes animation-1jtiq51{0%{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}50%{-webkit-transform:translateX(4px);-moz-transform:translateX(4px);-ms-transform:translateX(4px);transform:translateX(4px);}100%{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}}@keyframes animation-1jtiq51{0%{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}50%{-webkit-transform:translateX(4px);-moz-transform:translateX(4px);-ms-transform:translateX(4px);transform:translateX(4px);}100%{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}}@-webkit-keyframes animation-jgfc7h{0%{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}50%{-webkit-transform:translateX(-4px);-moz-transform:translateX(-4px);-ms-transform:translateX(-4px);transform:translateX(-4px);}100%{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}}@keyframes animation-jgfc7h{0%{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}50%{-webkit-transform:translateX(-4px);-moz-transform:translateX(-4px);-ms-transform:translateX(-4px);transform:translateX(-4px);}100%{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);transform:translateX(0);}}@-webkit-keyframes animation-1s0cgyd{0%{opacity:0;}20%{opacity:1;}40%{opacity:0;}100%{opacity:0;}}@keyframes animation-1s0cgyd{0%{opacity:0;}20%{opacity:1;}40%{opacity:0;}100%{opacity:0;}}</style><span class="logo css-ifwihp"><span class="left blue">&lt;Â </span>Boboan<span class="right blue">Â &gt;</span></span></div><style data-emotion="css iq45b0">.css-iq45b0 .MuiTabs-indicator{display:none;}</style><div class="MuiBox-root css-iq45b0"><style data-emotion="css orq8zk">.css-orq8zk{overflow:hidden;min-height:48px;-webkit-overflow-scrolling:touch;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}@media (max-width:599.95px){.css-orq8zk .MuiTabs-scrollButtons{display:none;}}</style><div class="MuiTabs-root css-orq8zk"><style data-emotion="css 1anid1y">.css-1anid1y{position:relative;display:inline-block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;white-space:nowrap;overflow-x:hidden;width:100%;}</style><div class="MuiTabs-scroller MuiTabs-fixed css-1anid1y" style="overflow:hidden;margin-bottom:0"><style data-emotion="css k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="MuiTabs-flexContainer css-k008qs" role="tablist"><a indicator="[object Object]" selected="" textColor="primary" value="0" href="/boboan.github.io"><style data-emotion="css 1n3lwq2">.css-1n3lwq2{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.25;letter-spacing:0.02857em;text-transform:uppercase;max-width:360px;min-width:90px;position:relative;min-height:48px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;padding:12px 16px;overflow:hidden;white-space:normal;text-align:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;color:inherit;opacity:0.6;}.css-1n3lwq2.Mui-selected{opacity:1;}.css-1n3lwq2.Mui-disabled{opacity:0.38;}</style><style data-emotion="css wigwbp">.css-wigwbp{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.25;letter-spacing:0.02857em;text-transform:uppercase;max-width:360px;min-width:90px;position:relative;min-height:48px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;padding:12px 16px;overflow:hidden;white-space:normal;text-align:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;color:inherit;opacity:0.6;}.css-wigwbp::-moz-focus-inner{border-style:none;}.css-wigwbp.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-wigwbp{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-wigwbp.Mui-selected{opacity:1;}.css-wigwbp.Mui-disabled{opacity:0.38;}</style><button class="MuiButtonBase-root MuiTab-root MuiTab-textColorInherit css-wigwbp" tabindex="-1" type="button" role="tab">é¦–é¡µ</button></a><a textColor="primary" value="1" href="/boboan.github.io/posts"><button class="MuiButtonBase-root MuiTab-root MuiTab-textColorInherit css-wigwbp" tabindex="-1" type="button" role="tab">æ–‡ç« </button></a><a textColor="primary" value="2" href="/boboan.github.io/tags/screeps"><button class="MuiButtonBase-root MuiTab-root MuiTab-textColorInherit css-wigwbp" tabindex="-1" type="button" role="tab">Screeps</button></a><a textColor="primary" value="3" href="/boboan.github.io/demos"><button class="MuiButtonBase-root MuiTab-root MuiTab-textColorInherit css-wigwbp" tabindex="-1" type="button" role="tab">Demos</button></a></div></div></div></div></div><style data-emotion="css 1e4r7a2">.css-1e4r7a2{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;}.css-1e4r7a2:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1e4r7a2:hover{background-color:transparent;}}.css-1e4r7a2.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 10hcgjg">.css-10hcgjg{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;}.css-10hcgjg::-moz-focus-inner{border-style:none;}.css-10hcgjg.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-10hcgjg{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-10hcgjg:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-10hcgjg:hover{background-color:transparent;}}.css-10hcgjg.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-10hcgjg" tabindex="0" type="button"><style data-emotion="css vubbuv">.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="Brightness4Icon"><path d="M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69zM12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6z"></path></svg></button></div></div></div></header></nav></header><style data-emotion="css 1qsxih2">.css-1qsxih2{width:100%;margin-left:auto;box-sizing:border-box;margin-right:auto;display:block;padding-left:16px;padding-right:16px;}@media (min-width:600px){.css-1qsxih2{padding-left:24px;padding-right:24px;}}@media (min-width:1200px){.css-1qsxih2{max-width:1200px;}}</style><div class="MuiContainer-root MuiContainer-maxWidthLg css-1qsxih2"><style data-emotion="css 13g8d5o">.css-13g8d5o{-webkit-flex:1;-ms-flex:1;flex:1;margin-top:16px;}</style><main class="css-13g8d5o"><style data-emotion="css yumteu">.css-yumteu{padding:16px;}.css-yumteu .post-view{max-width:800px;}.css-yumteu img{display:block;max-width:80%;margin:0 auto;}.css-yumteu .code-toolbar{margin-left:32px;max-width:600px;font-size:12px!important;}.css-yumteu pre{max-height:600px;}.css-yumteu a{color:#03a9f4;}</style><style data-emotion="css z27alm">.css-z27alm{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 2px 1px -1px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 1px 3px 0px rgba(0,0,0,0.12);padding:16px;}.css-z27alm .post-view{max-width:800px;}.css-z27alm img{display:block;max-width:80%;margin:0 auto;}.css-z27alm .code-toolbar{margin-left:32px;max-width:600px;font-size:12px!important;}.css-z27alm pre{max-height:600px;}.css-z27alm a{color:#03a9f4;}</style><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation1 css-z27alm"><article><style data-emotion="css ur44v1">.css-ur44v1{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:2.125rem;line-height:1.235;letter-spacing:0.00735em;margin-bottom:0.35em;font-weight:800;}</style><h4 class="MuiTypography-root MuiTypography-h4 MuiTypography-gutterBottom css-ur44v1">[eggjs]å¼‚å¸¸æ•è·ä¸­é—´ä»¶ï¼Œä¸€ä¸‹å­ç†è§£koaæ´‹è‘±åœˆæ¨¡å‹</h4><style data-emotion="css 3vlblt">.css-3vlblt{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.75;letter-spacing:0.00938em;margin-bottom:0.35em;}</style><h6 class="MuiTypography-root MuiTypography-subtitle1 MuiTypography-gutterBottom css-3vlblt">2020-04-10</h6><div class="post-view line-numbers MuiBox-root css-0"><p>å¼€å§‹çœ‹koaçš„æ—¶å€™æœ‰ä¸€ä¸ªæ´‹è‘±åœˆæ¨¡å‹çš„æ¦‚å¿µï¼Œä¸€ç›´æ²¡å¼„æ˜ç™½ã€‚ç›´åˆ°æˆ‘åœ¨è·Ÿç€eggæ–‡æ¡£å†™å¼‚å¸¸æ•è·çš„æ—¶å€™ï¼Œçªç„¶æ˜ç™½äº†å’‹å›äº‹ã€‚</p>
<p>eggçš„æ–‡æ¡£ææœ‰è¶…è¯¦ç»†çš„æ•™ç¨‹ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ å†™ä¸€ä¸ªåå°æœåŠ¡
è¿™é‡Œï¼š<a href="https://eggjs.org/zh-cn/intro/quickstart.html">https://eggjs.org/zh-cn/intro/quickstart.html</a></p>
<h2>ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†</h2>
<p>åœ¨å¼€å‘æœåŠ¡æ—¶ï¼Œä¼šé‡åˆ°å¾ˆå¤šå¼‚å¸¸å’Œé”™è¯¯ï¼Œæ¯”å¦‚æ•°æ®åº“æŠ¥é”™è¿™ç§å¼‚å¸¸ï¼Œæ¯”å¦‚å¯†ç é”™è¯¯è¿™ç§ä¸šåŠ¡ç›¸å…³çš„é”™è¯¯ã€‚é‚£å½“é‡åˆ°é”™è¯¯æ—¶ï¼Œå°±ä¸éœ€è¦æ‰§è¡Œåé¢çš„é€»è¾‘ï¼Œç›´æ¥å“åº”ä¸€ä¸ªé”™è¯¯ç»™å®¢æˆ·ç«¯ã€‚</p>
<h3>æ‹¿ç™»å½•æ¥å£ä¸¾ä¸ªä¾‹å­</h3>
<p><img src="/boboan.github.io/posts/3/1.jpg">
â‘ ç¬¬ä¸€æ­¥æ•°æ®åº“æ“ä½œï¼Œå¯èƒ½æˆ‘ä»¬éœ€è¦catchåˆ°é”™è¯¯ï¼Œå®Œåç»“æŸæ‰è¯·æ±‚</p>
<pre><code class="language-javascript">  try{
    //doSomething   ...ä½ çš„æ•°æ®åº“æ“ä½œ
  }catch(e){
      //å•Š  å‡ºé”™äº†ï¼Œè¿›è¡Œä¸ä¸‹å»äº†
      this.ctx.status=500
      this.ctx.body='å†™ç‚¹å•¥'
  }
</code></pre>
<p>â‘¡ç¬¬äºŒæ­¥ï¼Œæ•°æ®åº“æ˜¯å¥åº·çš„ï¼Œæˆ‘å¾—æ‹¿ç€Unameå»è¯·æ±‚Useræ•°æ®äº†</p>
<pre><code class="language-javascript">    async getUserByUname(uname){
          const result = await model.user.getUserByUname(uname)  //æ‰§è¡Œsqlè¯­å¥
          //æ²¡æœ‰æ•°æ®ï¼Ÿé‚£å¾—è¿”å›ï¼šæ²¡æœ‰æ­¤ç”¨æˆ·
          if(result.length===0){
              //æŸ¥è¯¢ä¸åˆ°ï¼Œæ›´åˆ«æå¯†ç äº†
              this.ctx.body='æ²¡æœ‰æ­¤ç”¨æˆ·'
          }
          //ã€‚ã€‚ã€‚ä½ ä¹‹åçš„é€»è¾‘
    }
</code></pre>
<p>â‘¢ç¬¬ä¸‰æ­¥ï¼Œæˆ‘éƒ½ä¸æƒ³å†™äº†ï¼Œå·²ç»å¾ˆä¹±äº†ï¼Œæ¯ä¸ªé”™è¯¯éƒ½è¦åœ¨controlleræ–‡ä»¶æˆ–è€…serviceæ–‡ä»¶ä¸­å“åº”ä¸€ä¸ªé”™è¯¯åŸå› messageï¼Œæ‰¾éƒ½æ‰¾ä¸åˆ°</p>
<h3>è¯•è¯•æŠŠé”™è¯¯ç»Ÿä¸€ç®¡ç†</h3>
<pre><code class="language-javascript">//errorHandlerä¸­é—´ä»¶
export default () => {
  return async function errorHandler(ctx, next) {
    try {
      await next()
    } catch (err) {
      const status = err?.status || 500
      // ä¸çŸ¥é“æ˜¯å•¥çš„å¼‚å¸¸è®°å½•æ—¥å¿—
      status === 500 &#x26;&#x26; ctx.app.emit('error', err, ctx);
      const error = status === 500 &#x26;&#x26; ctx.app.config.env === 'prod'
        ? 'Internal Server Error'
        : err.message
      const msg = status > 600 ? CST_ERR_CODE[status] : error
      ctx.body = await ctx.service.response.format(status || 500, null, msg)
    }
  };
};
//è‡ªå®šä¹‰é”™è¯¯
export class CustError extends Error {
  status: number
  constructor(status: number, message?: string) {
    super()
    this.status = status
    if (message) {
      this.message = message
    }
  }
}
//é”™è¯¯ä»£ç 
export enum CST_ERR_CODE {
  // 10001-ç™»å½•-å¯†ç é”™è¯¯
  Login_WrongPass = 10001,
  // 10002-ç™»å½•-æ²¡æœ‰æ­¤ç”¨æˆ·
  Login_NoUser = 10002,
  // 10003-ç™»å½•-éªŒè¯å¤±è´¥
  Login_VerificationFail = 10003,
  // 10004-æ³¨å†Œ-é‡å¤çš„ç”¨æˆ·å
  Regist_SameUname = 10004,
  // 10005-æ³¨å†Œ-æ³¨å†Œå¤±è´¥
  Regist_Wrong = 10005
}
</code></pre>
<p>1.ä½¿ç”¨errorHandlerä¸­é—´ä»¶åŒ…è£¹çŒªæˆ‘ä»¬çš„ä»£ç ï¼Œåœ¨æˆ‘ä»¬çš„ä»£ç æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œåœ¨errorHandleré‡Œç»Ÿä¸€catché”™è¯¯ï¼Œå¹¶å“åº”é”™è¯¯
2.è‡ªå®šä¹‰çš„é”™è¯¯å¯¹è±¡ï¼Œåœ¨åˆ¤æ–­å‡ºç™»å½•é”™è¯¯é—®é¢˜æ—¶ï¼Œç›´æ¥<code>throw new CustError(CST_ERR_CODE.Login_WrongPass)</code>
3.å®šä¹‰é”™è¯¯ä»£ç </p>
<h3>æ´‹è‘±åœˆæ¨¡å‹</h3>
<p>é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¹²ï¼Œæˆ‘æƒ³èµ·äº†æˆ‘ä»¥å‰çœ‹åˆ°çš„æ´‹è‘±åœˆæ¨¡å‹çš„å›¾ç‰‡
<img src="/boboan.github.io/posts/3/2.png">
æœ€å†…éƒ¨æ˜¯APPï¼Œå¤–é¢æ˜¯ä¸€å±‚ä¸€å±‚çš„koaä¸­é—´ä»¶ï¼Œåœ¨æ¯ä¸ªä¸­é—´ä»¶ä¸­next()æ‰§è¡Œå†…éƒ¨çš„ä»£ç 
ä¸Šé¢è§£é‡Šçš„æ˜¯ErrorHandlerä¸­é—´ä»¶çš„ä½œç”¨ï¼Œå½“å†…éƒ¨æ´‹è‘±throwå‡ºé”™è¯¯æ—¶ï¼Œä½¿ç”¨ErrorHandlerä¸­é—´ä»¶catchåˆ°é”™è¯¯ç»“æŸæ‰æœ¬æ¬¡è¯·æ±‚
æ˜¯ä¸æ˜¯æ˜ç™½è¿™ä¸ªå¤§è‘±å¤´çš„å›¾ç‰‡æ˜¯å•¥æ„æ€äº†ğŸ˜€</p>
<p>ç„¶åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ è¿™ä¸€å †functionä¸€å®šè¦ç»„æˆä¸€ä¸ªasync awaitå¼‚æ­¥é“¾ï¼Œæ‰èƒ½catchä½</p>
</div></article></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"3","title":"[eggjs]å¼‚å¸¸æ•è·ä¸­é—´ä»¶ï¼Œä¸€ä¸‹å­ç†è§£koaæ´‹è‘±åœˆæ¨¡å‹","tags":["eggjs"],"date":"2020-04-10","image":"/boboan.github.io/posts/3/1.png","abstract":"å¼€å§‹çœ‹ koa çš„æ—¶å€™æœ‰ä¸€ä¸ªæ´‹è‘±åœˆæ¨¡å‹çš„æ¦‚å¿µï¼Œä¸€ç›´æ²¡å¼„æ˜ç™½ã€‚ç›´åˆ°æˆ‘åœ¨è·Ÿç€ egg æ–‡æ¡£å†™å¼‚å¸¸æ•è·çš„æ—¶å€™ï¼Œçªç„¶æ˜ç™½äº†å’‹å›äº‹ã€‚","contentHtml":"\u003cp\u003eå¼€å§‹çœ‹koaçš„æ—¶å€™æœ‰ä¸€ä¸ªæ´‹è‘±åœˆæ¨¡å‹çš„æ¦‚å¿µï¼Œä¸€ç›´æ²¡å¼„æ˜ç™½ã€‚ç›´åˆ°æˆ‘åœ¨è·Ÿç€eggæ–‡æ¡£å†™å¼‚å¸¸æ•è·çš„æ—¶å€™ï¼Œçªç„¶æ˜ç™½äº†å’‹å›äº‹ã€‚\u003c/p\u003e\n\u003cp\u003eeggçš„æ–‡æ¡£ææœ‰è¶…è¯¦ç»†çš„æ•™ç¨‹ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ å†™ä¸€ä¸ªåå°æœåŠ¡\nè¿™é‡Œï¼š\u003ca href=\"https://eggjs.org/zh-cn/intro/quickstart.html\"\u003ehttps://eggjs.org/zh-cn/intro/quickstart.html\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003eç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†\u003c/h2\u003e\n\u003cp\u003eåœ¨å¼€å‘æœåŠ¡æ—¶ï¼Œä¼šé‡åˆ°å¾ˆå¤šå¼‚å¸¸å’Œé”™è¯¯ï¼Œæ¯”å¦‚æ•°æ®åº“æŠ¥é”™è¿™ç§å¼‚å¸¸ï¼Œæ¯”å¦‚å¯†ç é”™è¯¯è¿™ç§ä¸šåŠ¡ç›¸å…³çš„é”™è¯¯ã€‚é‚£å½“é‡åˆ°é”™è¯¯æ—¶ï¼Œå°±ä¸éœ€è¦æ‰§è¡Œåé¢çš„é€»è¾‘ï¼Œç›´æ¥å“åº”ä¸€ä¸ªé”™è¯¯ç»™å®¢æˆ·ç«¯ã€‚\u003c/p\u003e\n\u003ch3\u003eæ‹¿ç™»å½•æ¥å£ä¸¾ä¸ªä¾‹å­\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"/boboan.github.io/posts/3/1.jpg\"\u003e\nâ‘ ç¬¬ä¸€æ­¥æ•°æ®åº“æ“ä½œï¼Œå¯èƒ½æˆ‘ä»¬éœ€è¦catchåˆ°é”™è¯¯ï¼Œå®Œåç»“æŸæ‰è¯·æ±‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e  try{\n    //doSomething   ...ä½ çš„æ•°æ®åº“æ“ä½œ\n  }catch(e){\n      //å•Š  å‡ºé”™äº†ï¼Œè¿›è¡Œä¸ä¸‹å»äº†\n      this.ctx.status=500\n      this.ctx.body='å†™ç‚¹å•¥'\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eâ‘¡ç¬¬äºŒæ­¥ï¼Œæ•°æ®åº“æ˜¯å¥åº·çš„ï¼Œæˆ‘å¾—æ‹¿ç€Unameå»è¯·æ±‚Useræ•°æ®äº†\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e    async getUserByUname(uname){\n          const result = await model.user.getUserByUname(uname)  //æ‰§è¡Œsqlè¯­å¥\n          //æ²¡æœ‰æ•°æ®ï¼Ÿé‚£å¾—è¿”å›ï¼šæ²¡æœ‰æ­¤ç”¨æˆ·\n          if(result.length===0){\n              //æŸ¥è¯¢ä¸åˆ°ï¼Œæ›´åˆ«æå¯†ç äº†\n              this.ctx.body='æ²¡æœ‰æ­¤ç”¨æˆ·'\n          }\n          //ã€‚ã€‚ã€‚ä½ ä¹‹åçš„é€»è¾‘\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eâ‘¢ç¬¬ä¸‰æ­¥ï¼Œæˆ‘éƒ½ä¸æƒ³å†™äº†ï¼Œå·²ç»å¾ˆä¹±äº†ï¼Œæ¯ä¸ªé”™è¯¯éƒ½è¦åœ¨controlleræ–‡ä»¶æˆ–è€…serviceæ–‡ä»¶ä¸­å“åº”ä¸€ä¸ªé”™è¯¯åŸå› messageï¼Œæ‰¾éƒ½æ‰¾ä¸åˆ°\u003c/p\u003e\n\u003ch3\u003eè¯•è¯•æŠŠé”™è¯¯ç»Ÿä¸€ç®¡ç†\u003c/h3\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e//errorHandlerä¸­é—´ä»¶\nexport default () =\u003e {\n  return async function errorHandler(ctx, next) {\n    try {\n      await next()\n    } catch (err) {\n      const status = err?.status || 500\n      // ä¸çŸ¥é“æ˜¯å•¥çš„å¼‚å¸¸è®°å½•æ—¥å¿—\n      status === 500 \u0026#x26;\u0026#x26; ctx.app.emit('error', err, ctx);\n      const error = status === 500 \u0026#x26;\u0026#x26; ctx.app.config.env === 'prod'\n        ? 'Internal Server Error'\n        : err.message\n      const msg = status \u003e 600 ? CST_ERR_CODE[status] : error\n      ctx.body = await ctx.service.response.format(status || 500, null, msg)\n    }\n  };\n};\n//è‡ªå®šä¹‰é”™è¯¯\nexport class CustError extends Error {\n  status: number\n  constructor(status: number, message?: string) {\n    super()\n    this.status = status\n    if (message) {\n      this.message = message\n    }\n  }\n}\n//é”™è¯¯ä»£ç \nexport enum CST_ERR_CODE {\n  // 10001-ç™»å½•-å¯†ç é”™è¯¯\n  Login_WrongPass = 10001,\n  // 10002-ç™»å½•-æ²¡æœ‰æ­¤ç”¨æˆ·\n  Login_NoUser = 10002,\n  // 10003-ç™»å½•-éªŒè¯å¤±è´¥\n  Login_VerificationFail = 10003,\n  // 10004-æ³¨å†Œ-é‡å¤çš„ç”¨æˆ·å\n  Regist_SameUname = 10004,\n  // 10005-æ³¨å†Œ-æ³¨å†Œå¤±è´¥\n  Regist_Wrong = 10005\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e1.ä½¿ç”¨errorHandlerä¸­é—´ä»¶åŒ…è£¹çŒªæˆ‘ä»¬çš„ä»£ç ï¼Œåœ¨æˆ‘ä»¬çš„ä»£ç æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œåœ¨errorHandleré‡Œç»Ÿä¸€catché”™è¯¯ï¼Œå¹¶å“åº”é”™è¯¯\n2.è‡ªå®šä¹‰çš„é”™è¯¯å¯¹è±¡ï¼Œåœ¨åˆ¤æ–­å‡ºç™»å½•é”™è¯¯é—®é¢˜æ—¶ï¼Œç›´æ¥\u003ccode\u003ethrow new CustError(CST_ERR_CODE.Login_WrongPass)\u003c/code\u003e\n3.å®šä¹‰é”™è¯¯ä»£ç \u003c/p\u003e\n\u003ch3\u003eæ´‹è‘±åœˆæ¨¡å‹\u003c/h3\u003e\n\u003cp\u003eé‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¹²ï¼Œæˆ‘æƒ³èµ·äº†æˆ‘ä»¥å‰çœ‹åˆ°çš„æ´‹è‘±åœˆæ¨¡å‹çš„å›¾ç‰‡\n\u003cimg src=\"/boboan.github.io/posts/3/2.png\"\u003e\næœ€å†…éƒ¨æ˜¯APPï¼Œå¤–é¢æ˜¯ä¸€å±‚ä¸€å±‚çš„koaä¸­é—´ä»¶ï¼Œåœ¨æ¯ä¸ªä¸­é—´ä»¶ä¸­next()æ‰§è¡Œå†…éƒ¨çš„ä»£ç \nä¸Šé¢è§£é‡Šçš„æ˜¯ErrorHandlerä¸­é—´ä»¶çš„ä½œç”¨ï¼Œå½“å†…éƒ¨æ´‹è‘±throwå‡ºé”™è¯¯æ—¶ï¼Œä½¿ç”¨ErrorHandlerä¸­é—´ä»¶catchåˆ°é”™è¯¯ç»“æŸæ‰æœ¬æ¬¡è¯·æ±‚\næ˜¯ä¸æ˜¯æ˜ç™½è¿™ä¸ªå¤§è‘±å¤´çš„å›¾ç‰‡æ˜¯å•¥æ„æ€äº†ğŸ˜€\u003c/p\u003e\n\u003cp\u003eç„¶åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ è¿™ä¸€å †functionä¸€å®šè¦ç»„æˆä¸€ä¸ªasync awaitå¼‚æ­¥é“¾ï¼Œæ‰èƒ½catchä½\u003c/p\u003e\n"},"allTags":["nextjs","remark","typescript","taro","webpack","loader","å°ç¨‹åºæ’ä»¶","javascript","react","extention","github page","screeps","nodejs","é—²çš„","canvas","promise","vue","Parcel","eggjs","extension"]},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"3"},"buildId":"sFUQrHDn7cL7a1jlmj8Ox","assetPrefix":"/boboan.github.io","isFallback":false,"gsp":true}</script></body></html>