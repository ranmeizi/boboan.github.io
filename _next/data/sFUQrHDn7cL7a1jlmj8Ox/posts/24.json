{"pageProps":{"postData":{"id":"24","title":"隐藏vconsole小把戏，幸福感爆棚","tags":["javascript"],"date":"2021-09-09","image":"/boboan.github.io/images/tags/js.jpg","abstract":"线上环境有时候也需要启用vconsole来调试程序，来回部署又有些不方便 想了一个好玩的办法来隐藏vconsole","contentHtml":"<p>线上环境有时候也需要启用vconsole来调试程序，来回部署又有些不方便\n想了一个好玩的办法来隐藏vconsole\n想要设置一个debug开关，在开启之后呢，我就一直处于debug模式可以使用vconsole\n保持状态可以使用localstorage\n开关我用的是触摸事件输入摩尔斯码开启的\n大改是这个逻辑\n1.设置个存放正确密码在success数组，和存放输入密码的action数组\n2.监听触摸的时间长短来判断是tap还是press\n3.输入的这位对应success对应位置的密码正确，就放进action数组，错误就清空action数组\n4.当success数组等于action数组时，就开启开关啦</p>\n<pre><code class=\"language-javascript\">(function () {\n\n    var _YK_VC_OPEN_ = '_YK_VC_OPEN_'\n\n    var shouldOpen = localStorage.getItem(_YK_VC_OPEN_) === _YK_VC_OPEN_\n\n    if (shouldOpen) {\n        open()\n    } else {\n        lock()\n    }\n\n    function open() {\n        var vConsole = new VConsole();\n    }\n\n    function lock() {\n        /*\n                打开条件\n                V\t．．．━\n                C\t━ ．━ ．\n            */\n        var TYPES = {\n            tap: 'tap',\n            press: 'press'\n        }\n        // 开启条件\n        var success = [\n            TYPES.tap,\n            TYPES.tap,\n            TYPES.tap,\n            TYPES.press,\n            TYPES.press,\n            TYPES.tap,\n            TYPES.press,\n            TYPES.tap\n        ]\n        // action策略\n        var Strategy = {\n            [TYPES.tap]: function onTap() {\n                actionList.push(TYPES.tap)\n            },\n            [TYPES.press]: function onPress() {\n                actionList.push(TYPES.press)\n            }\n        }\n        // action记录\n        var actionList = []\n        var tapDuration = [0, 500]\n        var pressDuration = [3000, 10000]\n\n        var lastDownTime = 0\n\n        function onAction(currType) {\n            try {\n                const action = Strategy[currType]\n                if (typeof action !== 'function') {\n                    throw new Error('不正确的点击')\n                }\n                if (!check(currType)) {\n                    throw new Error('输入错误')\n                }\n                action()\n                // console.log('键入', currType)\n                if (actionList.length === success.length) {\n                    unlock()\n                }\n            } catch (e) {\n                // console.log(e.message)\n                actionList = []\n            }\n        }\n\n        function check(currType) {\n            const curIndex = actionList.length\n            return currType === success[curIndex]\n        }\n\n        function onDown() {\n            // console.log('down')\n            lastDownTime = Date.now()\n        }\n\n        function onUp(e) {\n            var duration = Date.now() - lastDownTime\n            // console.log('up', duration)\n            if (duration &#x3C; tapDuration[1]) {\n                onAction(TYPES.tap)\n            } else if (duration > pressDuration[0] &#x26;&#x26; duration &#x3C; pressDuration[1]) {\n                onAction(TYPES.press)\n            } else {\n                onAction('other')\n            }\n        }\n\n        function unlock() {\n            alert('行，你破解了密码，进入debug模式吧')\n            window.removeEventListener('touchstart', onDown)\n            window.removeEventListener('touchend', onUp)\n            // 存localstorage\n            localStorage.setItem(_YK_VC_OPEN_, _YK_VC_OPEN_)\n            open()\n        }\n\n        window.addEventListener('touchstart', onDown)\n        window.addEventListener('touchend', onUp)\n    }\n})()\n</code></pre>\n"},"allTags":["nextjs","remark","typescript","taro","webpack","loader","小程序插件","javascript","react","extention","github page","screeps","nodejs","闲的","canvas","promise","vue","Parcel","eggjs","extension"]},"__N_SSG":true}